<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>2D Curl-Preserving L2-Bestapproximation · GradientRobustMultiPhysics.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">GradientRobustMultiPhysics.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Problem Description</span><ul><li><a class="tocitem" href="../../pdedescription/">PDE Description</a></li><li><a class="tocitem" href="../../pdeoperators/">PDE Operators</a></li><li><a class="tocitem" href="../../functionoperators/">Function Operators</a></li><li><a class="tocitem" href="../../userdata/">User Data and Action Kernels</a></li><li><a class="tocitem" href="../../boundarydata/">Boundary Data</a></li><li><a class="tocitem" href="../../globalconstraints/">Global Constraints</a></li><li><a class="tocitem" href="../../pdeprototypes/">PDE Prototypes</a></li></ul></li><li><span class="tocitem">Discretisation</span><ul><li><a class="tocitem" href="../../meshing/">Meshing</a></li><li><a class="tocitem" href="../../fems/">Implemented Finite Elements</a></li><li><a class="tocitem" href="../../fespace/">Finite Element Spaces and Arrays</a></li><li><a class="tocitem" href="../../interpolations/">Finite Element Interpolations</a></li><li><a class="tocitem" href="../../quadrature/">Quadrature</a></li><li><a class="tocitem" href="../../assembly_details/">Assembly Details</a></li></ul></li><li><span class="tocitem">Solving</span><ul><li><a class="tocitem" href="../../pdesolvers/">Fixed-Time Solvers</a></li><li><a class="tocitem" href="../../timecontrolsolver/">Time-Dependent Solvers</a></li></ul></li><li><span class="tocitem">Postprocessing</span><ul><li><a class="tocitem" href="../../viewers/">Viewers</a></li><li><a class="tocitem" href="../../export/">Data Export</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples_intro/">How to run the examples</a></li><li><input class="collapse-toggle" id="menuitem-6-2" type="checkbox" checked/><label class="tocitem" for="menuitem-6-2"><span class="docs-label">Examples (Intro)</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../doc_1d_bestapprox/">1D L2-Bestapproximation</a></li><li class="is-active"><a class="tocitem" href>2D Curl-Preserving L2-Bestapproximation</a></li><li><a class="tocitem" href="../doc_2d_commutinginterpolators/">Commuting Interpolators (2D)</a></li><li><a class="tocitem" href="../doc_2d_convectiondiffusion/">2D Convection-Diffusion-Problem</a></li><li><a class="tocitem" href="../doc_2d_cookmembrane/">2D Linear Elasticity</a></li><li><a class="tocitem" href="../doc_2d_fe_on_faces/">2D Finite Elements on Faces</a></li><li><a class="tocitem" href="../doc_2d_flowtransport/">2D Flow + Transport</a></li><li><a class="tocitem" href="../doc_2d_liddrivencavity_anderson/">2D Lid-driven cavity (Anderson Acceleration)</a></li><li><a class="tocitem" href="../doc_2d_lshape_adaptivity/">2D Adaptive Mesh Refinement (L-shape)</a></li><li><a class="tocitem" href="../doc_2d_nonlin_poisson/">2D Nonlinear Poisson-Problem</a></li><li><a class="tocitem" href="../doc_2d_nonlin_poisson_timedependent/">2D Nonlinear Poisson (time-dependent)</a></li><li><a class="tocitem" href="../doc_2d_plaplace/">2D Nonlinear Poisson (p-Laplacian)</a></li><li><a class="tocitem" href="../doc_2d_stokes_iterated/">2D Stokes (iterated penalty method)</a></li><li><a class="tocitem" href="../doc_2d_stokes_probust/">2D Pressure-robustness</a></li><li><a class="tocitem" href="../doc_2d_transientstokes/">2D Transient Stokes-Problem</a></li><li><a class="tocitem" href="../doc_3d_bestapprox_divpreserve/">3D Divergence-Preserving L2-Bestapproximation</a></li><li><a class="tocitem" href="../doc_3d_commutinginterpolators/">Commuting Interpolators (3D)</a></li><li><a class="tocitem" href="../doc_3d_poisson/">3D Poisson-Problem</a></li><li><a class="tocitem" href="../doc_rational_massmatrix/">Rational Mass Matrix</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-3" type="checkbox"/><label class="tocitem" for="menuitem-6-3"><span class="docs-label">Examples (Advanced)</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples_advanced/doc_2d_compressiblestokes/">2D Compressible Stokes</a></li><li><a class="tocitem" href="../../examples_advanced/doc_2d_lshape_adaptivity_eq/">2D Equilibration Error Estimation (Global)</a></li><li><a class="tocitem" href="../../examples_advanced/doc_2d_lshape_adaptivity_loceq/">2D Equilibration Error Estimation (Local)</a></li><li><a class="tocitem" href="../../examples_advanced/doc_2d_naturalconvection/">2D Natural Convection</a></li><li><a class="tocitem" href="../../examples_advanced/doc_2d_nonlin_diffeq/">2D Comparison with DifferentialEquations.jl</a></li><li><a class="tocitem" href="../../examples_advanced/doc_2d_other_linsolver/">2D User-defined Linear Solvers</a></li><li><a class="tocitem" href="../../examples_advanced/doc_2d_stokes_hdiv-dg/">2D DG-Hdiv discretisation for Stokes</a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li><a class="is-disabled">Examples (Intro)</a></li><li class="is-active"><a href>2D Curl-Preserving L2-Bestapproximation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>2D Curl-Preserving L2-Bestapproximation</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/chmerdon/GradientRobustMultiPhysics.jl/blob/master/docs/src/examples/doc_2d_bestapprox_curlpreserve.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="D-Curl-Preserving-L2-Bestapproximation"><a class="docs-heading-anchor" href="#D-Curl-Preserving-L2-Bestapproximation">2D Curl-Preserving L2-Bestapproximation</a><a id="D-Curl-Preserving-L2-Bestapproximation-1"></a><a class="docs-heading-anchor-permalink" href="#D-Curl-Preserving-L2-Bestapproximation" title="Permalink"></a></h1><p>(<a href="https://github.com/chmerdon/GradientRobustMultiPhysics.jl/raw/master/examples/doc_2d_bestapprox_curlpreserve.jl">source code</a>)</p><p>This example computes the L2-bestapproximation of some given vector-valued function into the lowest-order Nedelec space. It also preserves the curl of the function in the sense that the curl of the approximation equals the piecewise integral mean of the exact curl. Afterwards the L2 error (also of the curl) is computed and the solution is plotted.</p><pre><code class="language-julia">module Example_2DBestapproxCurlpreserve

using GradientRobustMultiPhysics
using ExtendableGrids

# define some vector field that should be approximated
function exact_function!(result,x::Array{&lt;:Real,1})
    result[1] = x[1]^3+x[2]^2
    result[2] = -x[1]^2 + x[2] + 1
end
# define its curl = -du2/dx1 + du1/dx2
function exact_curl!(result,x::Array{&lt;:Real,1})
    result[1] = 2 * x[2] + 2 * x[1]
end

# everything is wrapped in a main function
function main(; verbosity = 0, Plotter = nothing)

    # set log level
    set_verbosity(verbosity)

    # generate a unit square mesh and refine
    xgrid = simplexgrid([0.0,1.0],[0.0,1.0])
    xgrid = uniform_refine(xgrid,4)

    # negotiate exact_function! and exact_curl! to the package
    user_function = DataFunction(exact_function!, [2,2]; name = &quot;u&quot;, dependencies = &quot;X&quot;, quadorder = 3)
    user_function_curl = DataFunction(exact_curl!, [1,2]; name = &quot;curl(u)&quot;, dependencies = &quot;X&quot;, quadorder = 1)

    # setup a bestapproximation problem via a predefined prototype
    Problem = L2BestapproximationProblem(user_function; bestapprox_boundary_regions = [1,2,3,4])

    # add a new unknown (Lagrange multiplier that handles the curl constraint)
    # here 1 is the number of components (it is scalar-valued) and 2 is the space dimension
    add_unknown!(Problem; unknown_name = &quot;p&quot;, equation_name = &quot;curl constraint&quot;)
    add_operator!(Problem, [1,2], LagrangeMultiplier(Curl2D))

    # add the right-hand side data for the constraint and inspect the defined problem
    add_rhsdata!(Problem, 2, RhsOperator(Identity, [0], user_function_curl))
    @show Problem

    # choose some (inf-sup stable) finite element types
    FEType = [HCURLN0{2}, H1P0{1}]
    FES = [FESpace{FEType[1]}(xgrid),FESpace{FEType[2]}(xgrid)]

    # create a solution vector and solve the problem
    Solution = FEVector{Float64}([&quot;u_h&quot;,&quot;p_h&quot;],FES)
    solve!(Solution, Problem)

    # calculate L2 error and L2 curl error
    L2ErrorEvaluator = L2ErrorIntegrator(Float64, user_function, Identity)
    L2CurlErrorEvaluator = L2ErrorIntegrator(Float64, user_function_curl, Curl2D)
    println(&quot;|| u - u_h || = $(sqrt(evaluate(L2ErrorEvaluator,Solution[1])))&quot;)
    println(&quot;|| curl(u - u_h) || = $(sqrt(evaluate(L2CurlErrorEvaluator,Solution[1])))&quot;)

    # plot
    GradientRobustMultiPhysics.plot(xgrid, [Solution[1], Solution[1]], [Identity, Curl2D]; Plotter = Plotter)
end

end</code></pre><pre><code class="language-none">Main.##258.Example_2DBestapproxCurlpreserve</code></pre><h3 id="Output-of-default-main()-run"><a class="docs-heading-anchor" href="#Output-of-default-main()-run">Output of default main() run</a><a id="Output-of-default-main()-run-1"></a><a class="docs-heading-anchor-permalink" href="#Output-of-default-main()-run" title="Permalink"></a></h3><pre><code class="language-julia">Example_2DBestapproxCurlpreserve.main()</code></pre><pre><code class="language-none">
PDE-DESCRIPTION
===============
  system name = L2-Bestapproximation problem

     id   | unknown name / equation name
    [1]   | u / L2-bestapproximation equation 
    [2]   | p / curl constraint 

  LHS block | PDEOperator(s)
    [1,1]   | u ⋅ v (regions = [0])
    [1,2]   | Curl(v) ⋅ q (regions = [0])
    [2,1]   | none
    [2,2]   | none

  RHS block | PDEOperator(s)
     [1]    | u⋅id(v) (regions = [0])
     [2]    | curl(u)⋅id(v) (regions = [0])

   BoundaryOperator[1] : BestapproxDirichletBoundary -&gt; [1, 2, 3, 4]
                         
   BoundaryOperator[2] : 

Problem = 
┌ Info: ----- Solving L2-Bestapproximation problem -----
│ 	Equation (1.1) L2-bestapproximation equation : u &gt;&gt; u_h (HCURLN0{2}, ndofs = 800)
│ 	Equation (1.2) curl constraint : p &gt;&gt; p_h (H1P0{1} (broken), ndofs = 512)
└ @ GradientRobustMultiPhysics /home/runner/work/GradientRobustMultiPhysics.jl/GradientRobustMultiPhysics.jl/src/solvers.jl:1124
┌ Info: overall residual = 1.496430412122555e-15
└ @ GradientRobustMultiPhysics /home/runner/work/GradientRobustMultiPhysics.jl/GradientRobustMultiPhysics.jl/src/solvers.jl:559
|| u - u_h || = 0.031068414520129824
|| curl(u - u_h) || = 0.051031036307982836
</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../doc_1d_bestapprox/">« 1D L2-Bestapproximation</a><a class="docs-footer-nextpage" href="../doc_2d_commutinginterpolators/">Commuting Interpolators (2D) »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Thursday 6 May 2021 19:15">Thursday 6 May 2021</span>. Using Julia version 1.6.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
