<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>User Data and Action Kernels · GradientRobustMultiPhysics.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">GradientRobustMultiPhysics.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Problem Description</span><ul><li><a class="tocitem" href="../pdedescription/">PDE Description</a></li><li><a class="tocitem" href="../pdeoperators/">PDE Operators</a></li><li><a class="tocitem" href="../functionoperators/">Function Operators</a></li><li class="is-active"><a class="tocitem" href>User Data and Action Kernels</a><ul class="internal"><li><a class="tocitem" href="#Data-Functions"><span>Data Functions</span></a></li><li><a class="tocitem" href="#Action-Kernels"><span>Action Kernels</span></a></li><li><a class="tocitem" href="#Action"><span>Action</span></a></li></ul></li><li><a class="tocitem" href="../boundarydata/">Boundary Data</a></li><li><a class="tocitem" href="../globalconstraints/">Global Constraints</a></li><li><a class="tocitem" href="../pdeprototypes/">PDE Prototypes</a></li></ul></li><li><span class="tocitem">Discretisation</span><ul><li><a class="tocitem" href="../meshing/">Meshing</a></li><li><a class="tocitem" href="../fems/">Implemented Finite Elements</a></li><li><a class="tocitem" href="../fespace/">Finite Element Spaces and Arrays</a></li><li><a class="tocitem" href="../interpolations/">Finite Element Interpolations</a></li><li><a class="tocitem" href="../quadrature/">Quadrature</a></li><li><a class="tocitem" href="../assembly_details/">Assembly Details</a></li></ul></li><li><span class="tocitem">Solving</span><ul><li><a class="tocitem" href="../pdesolvers/">Fixed-Time Solvers</a></li><li><a class="tocitem" href="../timecontrolsolver/">Time-Dependent Solvers</a></li></ul></li><li><span class="tocitem">Postprocessing</span><ul><li><a class="tocitem" href="../viewers/">Viewers</a></li><li><a class="tocitem" href="../export/">Data Export</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../examples_intro/">How to run the examples</a></li><li><input class="collapse-toggle" id="menuitem-6-2" type="checkbox"/><label class="tocitem" for="menuitem-6-2"><span class="docs-label">Examples (Intro)</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../examples/doc_1d_bestapprox/">1D L2-Bestapproximation</a></li><li><a class="tocitem" href="../examples/doc_2d_bestapprox_curlpreserve/">2D Curl-Preserving L2-Bestapproximation</a></li><li><a class="tocitem" href="../examples/doc_2d_commutinginterpolators/">Commuting Interpolators (2D)</a></li><li><a class="tocitem" href="../examples/doc_2d_convectiondiffusion/">2D Convection-Diffusion-Problem</a></li><li><a class="tocitem" href="../examples/doc_2d_cookmembrane/">2D Linear Elasticity</a></li><li><a class="tocitem" href="../examples/doc_2d_fe_on_faces/">2D Finite Elements on Faces</a></li><li><a class="tocitem" href="../examples/doc_2d_flowtransport/">2D Flow + Transport</a></li><li><a class="tocitem" href="../examples/doc_2d_liddrivencavity_anderson/">2D Lid-driven cavity (Anderson Acceleration)</a></li><li><a class="tocitem" href="../examples/doc_2d_lshape_adaptivity/">2D Adaptive Mesh Refinement (L-shape)</a></li><li><a class="tocitem" href="../examples/doc_2d_nonlin_poisson/">2D Nonlinear Poisson-Problem</a></li><li><a class="tocitem" href="../examples/doc_2d_nonlin_poisson_timedependent/">2D Nonlinear Poisson (time-dependent)</a></li><li><a class="tocitem" href="../examples/doc_2d_plaplace/">2D Nonlinear Poisson (p-Laplacian)</a></li><li><a class="tocitem" href="../examples/doc_2d_stokes_iterated/">2D Stokes (iterated penalty method)</a></li><li><a class="tocitem" href="../examples/doc_2d_stokes_probust/">2D Pressure-robustness</a></li><li><a class="tocitem" href="../examples/doc_2d_transientstokes/">2D Transient Stokes-Problem</a></li><li><a class="tocitem" href="../examples/doc_3d_bestapprox_divpreserve/">3D Divergence-Preserving L2-Bestapproximation</a></li><li><a class="tocitem" href="../examples/doc_3d_commutinginterpolators/">Commuting Interpolators (3D)</a></li><li><a class="tocitem" href="../examples/doc_3d_poisson/">3D Poisson-Problem</a></li><li><a class="tocitem" href="../examples/doc_rational_massmatrix/">Rational Mass Matrix</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-3" type="checkbox"/><label class="tocitem" for="menuitem-6-3"><span class="docs-label">Examples (Advanced)</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../examples_advanced/doc_2d_compressiblestokes/">2D Compressible Stokes</a></li><li><a class="tocitem" href="../examples_advanced/doc_2d_lshape_adaptivity_eq/">2D Equilibration Error Estimation (Global)</a></li><li><a class="tocitem" href="../examples_advanced/doc_2d_lshape_adaptivity_loceq/">2D Equilibration Error Estimation (Local)</a></li><li><a class="tocitem" href="../examples_advanced/doc_2d_naturalconvection/">2D Natural Convection</a></li><li><a class="tocitem" href="../examples_advanced/doc_2d_nonlin_diffeq/">2D Comparison with DifferentialEquations.jl</a></li><li><a class="tocitem" href="../examples_advanced/doc_2d_other_linsolver/">2D User-defined Linear Solvers</a></li><li><a class="tocitem" href="../examples_advanced/doc_2d_stokes_hdiv-dg/">2D DG-Hdiv discretisation for Stokes</a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Problem Description</a></li><li class="is-active"><a href>User Data and Action Kernels</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>User Data and Action Kernels</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/chmerdon/GradientRobustMultiPhysics.jl/blob/master/docs/src/userdata.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="User-Data-and-Action-Kernels"><a class="docs-heading-anchor" href="#User-Data-and-Action-Kernels">User Data and Action Kernels</a><a id="User-Data-and-Action-Kernels-1"></a><a class="docs-heading-anchor-permalink" href="#User-Data-and-Action-Kernels" title="Permalink"></a></h1><p>There is a variety of different user data, like scalar- and vector-valued constants, time-dependent data, region-dependent data or plain functions that depend on the the space coordinates. To allow for flexible user-specified data, all functions have to be negotiated by the UserData interface that fixes the order and number of dependencies.</p><h2 id="Data-Functions"><a class="docs-heading-anchor" href="#Data-Functions">Data Functions</a><a id="Data-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Data-Functions" title="Permalink"></a></h2><p>The simplest form of user data is called DataFunction and satisfies the interface</p><pre><code class="language-julia">function data_function!(result,x::Array{&lt;:Real,1},t::Real)
    # definition of result, possibly dependent on
    # X = space coordinates
    # T = time
end</code></pre><pre class="documenter-example-output">data_function! (generic function with 1 method)</pre><p>where the result vector carries the result of the function. Additionally, it can (but not has to) depend on the further inputs X (space coordinates) or T (time) DataFunctions can be used to define boundary data, right-hand side functions and can be interpolated by the finite element standard interpolations.</p><p>There are also ExtendedDataFunction that can additionally depend on R (region), I (item number) and L (local coordinates). The dependencies are stated via a string in the constructor that should be a substring of &quot;XTRIL&quot;. However, extended data functions cannot be used everywhere.</p><article class="docstring"><header><a class="docstring-binding" id="GradientRobustMultiPhysics.DataFunction" href="#GradientRobustMultiPhysics.DataFunction"><code>GradientRobustMultiPhysics.DataFunction</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">function DataFunction(
    f::Function,
    dimensions::Array{Int,1};
    name = &quot;user data function&quot;,
    dependencies::String = &quot;&quot;,
    quadorder::Int = 0)</code></pre><p>Provides a negotation interface for some user-defined function that  can be used in integrate! and boundary or right-hand side data assignments. The function f has to obey the interface</p><pre><code class="language-none">f(result, [X, T])</code></pre><p>where the parameters X (= space coordinates) and T ( = time) are optional. Which of them are used has to be specified in the  String dependencies. The string &quot;X&quot; for example specifies that the interface is only space-dependent, i.e</p><pre><code class="language-none">f(result, X)</code></pre><p>The array dimensions specifies the expected length of result and input and quadorder determines the additional quadrature order to be used if this function is involved in some quadrature-requireing procedure.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/chmerdon/GradientRobustMultiPhysics.jl/blob/018a99a007014069abe8fbde1fd0db8137abd469/src/userdata.jl#L120-L143">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="GradientRobustMultiPhysics.ExtendedDataFunction" href="#GradientRobustMultiPhysics.ExtendedDataFunction"><code>GradientRobustMultiPhysics.ExtendedDataFunction</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">function ExtendedDataFunction(
    f::Function,
    dimensions::Array{Int,1};
    name = &quot;user data function&quot;,
    dependencies::String = &quot;&quot;,
    quadorder::Int = 0)</code></pre><p>Provides a negotation interface for some data function with extended dependencies (region number, item number and local coordinates) that can be used in integrate!. The function f has to obey the interface</p><pre><code class="language-none">f(result, [X, T, R, I, L])</code></pre><p>where the parameters X (= space coordinates) and T ( = time) are optional. Which of them are used has to be specified in the  String dependencies. The string &quot;X,I&quot; for example specifies that the interface is only space-dependent and item-dependent, i.e</p><pre><code class="language-none">f(result, X, I)</code></pre><p>The array dimensions specifies the expected length of result and X (if X-depdendent, otherwise will be ignored) and quadorder determines the additional quadrature order to be used if this function is involved in some quadrature-requireing procedure.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/chmerdon/GradientRobustMultiPhysics.jl/blob/018a99a007014069abe8fbde1fd0db8137abd469/src/userdata.jl#L167-L191">source</a></section></article><h2 id="Action-Kernels"><a class="docs-heading-anchor" href="#Action-Kernels">Action Kernels</a><a id="Action-Kernels-1"></a><a class="docs-heading-anchor-permalink" href="#Action-Kernels" title="Permalink"></a></h2><p>Another for of user data are action kernel used to define an AbstractAction. Actions modify arguments of <a href="../assembly_details/#Assembly-Patterns">Assembly Patterns</a> (usually all but the last one) and so allow parameter-depend assemblies. To use them, the user defines some kernel function for the action that has the interface</p><pre><code class="language-julia">function action_kernel!(result,input,X,T,R,I,L)
    # result = modified input, e.g.
    # multiplication with some parameter that can depend on
    # X = space coordinates
    # T = time
    # R = region number
    # I = item number (cell, face or edge number depending on assembly type)
    # L = local coordinates on item reference domain
end</code></pre><pre class="documenter-example-output">action_kernel! (generic function with 1 method)</pre><p>During assembly, input (in general) takes the role of all non-testfunction arguments and the result vector will be the one that is multiplied with the testfunctions. Additionally, the kernel function can depend on X, T, R, I and L as specified above. Again, the dependencies of an action_kernel are stated via a string in the constructor that should be a substring of &quot;XTRIL&quot;. Note, that the avoidance of the X-dependency spares the computation of the global coordinates of the quadrature points in the assembly loops. Moreover, time-dependency of an action kernel e.g. triggers reassembly of the associated PDEoperator in each time step.</p><article class="docstring"><header><a class="docstring-binding" id="GradientRobustMultiPhysics.ActionKernel" href="#GradientRobustMultiPhysics.ActionKernel"><code>GradientRobustMultiPhysics.ActionKernel</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">function ActionKernel(
    f::Function,
    dimensions::Array{Int,1};
    name = &quot;user action kernel&quot;,
    dependencies::String = &quot;&quot;,
    quadorder::Int = 0)</code></pre><p>Provides a negotation interface for some function that can be used in the Action constructor to define a user-defined operator action. The function has to obey the interface</p><pre><code class="language-none">f(result, input, [X, T, R, I, L])</code></pre><p>where the parameters X (= space coordinates), T ( = time), R (= region number), I (= item number), L (= local coordinates) are optional. Which of them are used has to be specified in the String dependencies. The string &quot;XT&quot; for example specifies that the interface is only space and time dependent, i.e</p><pre><code class="language-none">f(result, input, X, T)</code></pre><p>The input vector usually provides the FunctionOperator evaluations of (a subset of) the ansatz arguments of the assembly pattern where the action is used. The array dimensions specifies the expected length of result and input and quadorder determines the additional quadrature order to be used if this function (or its derived action) is involved in an assembly process.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/chmerdon/GradientRobustMultiPhysics.jl/blob/018a99a007014069abe8fbde1fd0db8137abd469/src/userdata.jl#L16-L40">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="GradientRobustMultiPhysics.NLActionKernel" href="#GradientRobustMultiPhysics.NLActionKernel"><code>GradientRobustMultiPhysics.NLActionKernel</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">function NLActionKernel(
    f::Function,
    dimensions::Array{Int,1};
    name = &quot;nonlinear user action kernel&quot;,
    dependencies::String = &quot;&quot;,
    quadorder::Int = 0)</code></pre><p>Provides a negotation interface for some function to be used as a nonlinear action kernel that can be used in the NonlinearOperator constructor without automatic differentiation. The function f has to obey the interface</p><pre><code class="language-none">f(result, input_current, input_ansatz)</code></pre><p>and can be seen as a linearisation of a nonlinearity that can depend on the operator evaluation of the current iterate (input<em>current) and, as usual, the operator evaluations of the ansatz function (input</em>ansatz).</p><p>No further dependencies are allowed currently. Note, that this is a work-in-progress feature.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/chmerdon/GradientRobustMultiPhysics.jl/blob/018a99a007014069abe8fbde1fd0db8137abd469/src/userdata.jl#L87-L106">source</a></section></article><h2 id="Action"><a class="docs-heading-anchor" href="#Action">Action</a><a id="Action-1"></a><a class="docs-heading-anchor-permalink" href="#Action" title="Permalink"></a></h2><p>Actions are used by abstract user-defined PDEOperators and consist of an action kernel plus some additional infratructure. To generate an action from an action kernel works via the following functions.</p><article class="docstring"><header><a class="docstring-binding" id="GradientRobustMultiPhysics.Action" href="#GradientRobustMultiPhysics.Action"><code>GradientRobustMultiPhysics.Action</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">function Action(
    T::Type{&lt;:Real},
    kernel::UserData{&lt;:AbstractActionKernel};
    name::String = &quot;user action&quot;)</code></pre><p>Creates an Action from a given specified action kernel that then can be used in an assembly pattern. T specifies the number format that should match the number format of the used quadrature rules and grid coordinates in the mesh (usually Float64).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/chmerdon/GradientRobustMultiPhysics.jl/blob/018a99a007014069abe8fbde1fd0db8137abd469/src/actions.jl#L73-L83">source</a></section><section><div><pre><code class="language-none">function Action(
    T::Type{&lt;:Real},
    kernel_function::Function,
    dimensions::Array{Int,1};
    name = &quot;user action&quot;,
    dependencies = &quot;&quot;,
    quadorder = 0)</code></pre><p>Creates an Action directly from a kernel function (plus additional information to complement the action kernel) that then can be used in an assembly pattern. T specifies the number format that should match the number format of the used quadrature rules and grid coordinates in the mesh (usually Float64).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/chmerdon/GradientRobustMultiPhysics.jl/blob/018a99a007014069abe8fbde1fd0db8137abd469/src/actions.jl#L103-L116">source</a></section></article><p>Moreover, there are some shortcut action constructors that can be used directly without defining an action kernel first.</p><article class="docstring"><header><a class="docstring-binding" id="GradientRobustMultiPhysics.NoAction" href="#GradientRobustMultiPhysics.NoAction"><code>GradientRobustMultiPhysics.NoAction</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">function NoAction()</code></pre><p>Creates a NoAction that causes the assembly pattern to ignore the action assembly.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/chmerdon/GradientRobustMultiPhysics.jl/blob/018a99a007014069abe8fbde1fd0db8137abd469/src/actions.jl#L11-L17">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="GradientRobustMultiPhysics.MultiplyScalarAction" href="#GradientRobustMultiPhysics.MultiplyScalarAction"><code>GradientRobustMultiPhysics.MultiplyScalarAction</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">function MultiplyScalarAction(value, ncomponents::Int)</code></pre><p>Directly creates an Action that multiplies a scalar value to the input (vector of length ncomponents).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/chmerdon/GradientRobustMultiPhysics.jl/blob/018a99a007014069abe8fbde1fd0db8137abd469/src/actions.jl#L122-L128">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../functionoperators/">« Function Operators</a><a class="docs-footer-nextpage" href="../boundarydata/">Boundary Data »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Thursday 6 May 2021 18:05">Thursday 6 May 2021</span>. Using Julia version 1.6.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
